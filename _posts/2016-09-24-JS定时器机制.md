---
layout: post
title: JS定时器机制
description: 
categories:
 - Javascript
 
tags: 
 - 单线程 
 - 异步
 - setTimeout

image: assets/images/5.jpg

---


##单线程的js

   众所周知Javascript是单线程的，作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。
   当然单线程是只Javascript，我们要清楚浏览器还有其他的线程，当js处理异步任务的时候就是把任务交给其他线程去处理，异步任务线程完成后会通知主线程任务完成可以进入下一步处理，这就是JS单线程异步机制。


##定时器

   定时器功能主要由setTimeout()和setInterval()这两个函数来完成，它们的内部运行机制完全一样，区别在于前者指定的代码是一次性执行，后者则为反复执行。
    看这样一段代码：
    

```js
 setTimeout(function(){console.log(1);}, 0);
        console.log(2);
        //2
        //1
```

   从代码语义上分析是设置定时器0ms后输出1，然后输出2，但实际效果是先输出了2，再输出了1. why？
    因为setTimeout方法设置的定时器是添加到异步队列中，即使设置的定时时间再短也是要在主线程队列清空之后才能去
    拉去完成的异步任务队列判断是否执行回调，也即是说，在setTimeout之后不管设置的回调希望在多少ms之后执行，都需要等待当前的js代码执行完。
    所以上面的代码执行栈是：
    
   ```
   setTimeout 执行栈完成  
   console.log 执行栈完成
   执行栈为空
   定时器时间到向 执行栈添加任务完成回调
   定时器回调  执行栈完成  
   ```

