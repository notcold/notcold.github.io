---
layout: post
title: webpackå…¥é—¨
description: 
categories:
 - engineering 
tags: 
 - webpack
image: assets/images/5.jpg

---


## webpackå®‰è£…


é€šè¿‡nodeå®‰è£…ï¼Œæœ€æ–°
```
npm install --save-dev webpack

```
å¦‚æžœä½ ä½¿ç”¨ webpack v4+ ç‰ˆæœ¬ï¼Œä½ è¿˜éœ€è¦å®‰è£… CLIã€‚
```
npm install --save-dev webpack-cli

```

## webpacké…ç½®æ–‡ä»¶

   webpackæ˜¯ä¸€ä¸ªé™æ€æ–‡ä»¶æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå®ƒä¼šé€šè¿‡è§£æžé…ç½®å…¥å£æ–‡ä»¶æ¥ç”Ÿæˆæ‰€æœ‰æ˜ å°„æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œç„¶åŽå°†è¿™äº›ä¾èµ–ç”Ÿæˆä¸ºbundleã€‚
    
    
```
  // webpack.config.js 
  //ç®€å•çš„å•å…¥å£é…ç½®

const path = require('path');

module.exports = {
  entry: './src/index.js', //é…ç½®æ­è¥¿å…¥å£
  output: {
    filename: 'main.js', //è¾“å…¥ç»“æžœ
    path: path.resolve(__dirname, 'dist')
  }
};
```

### è§£æžæ–‡ä»¶
   
  webpackæ ¹æ®ä¸åŒçš„æ–‡ä»¶æ ¼å¼æ¥åŒ¹é…ç›¸å¯¹åº”çš„ ` loader `ï¼Œå¦‚æžœæ²¡æœ‰å¯¹åº”çš„ ` loader `æ–‡ä»¶å°±ä¸ä¼šè¢«è§£æžå¤„ç†ã€‚
  ```
  module.exports = {
    module: {
      rules: [
        { test: /\.css$/, use: 'css-loader' },
        { test: /\.ts$/, use: 'ts-loader' }
      ]
    }
  };
```
   é…ç½®è§„åˆ™å‘Šè¯‰webpack cssæ–‡ä»¶ç”¨css-loaderæ¥è§£æžï¼Œtsæ–‡ä»¶ç”¨ts-loaderæ¥è§£æžã€‚
   >loader æè¿°äº† webpack å¦‚ä½•å¤„ç† éž JavaScript(non-JavaScript) _æ¨¡å—_ï¼Œå¹¶ä¸”åœ¨bundleä¸­å¼•å…¥è¿™äº›_ä¾èµ–_ã€‚
   
  loader è§£æžå™¨èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å°†æˆ‘ä»¬ä¹¦å†™çš„æµè§ˆå™¨ä¸æ”¯æŒçš„å½¢å¼è£…æ¢ä¸ºæ ‡å‡†çš„jsï¼Œhtmlè¯­æ³•ï¼Œä»Žè€Œèƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚
   
###æ¨¡å—
  
  æ‰€æœ‰çš„æ–‡ä»¶è¢« ` loader `è§£æžä¹‹åŽç”Ÿæˆçš„éƒ½æ˜¯æ¨¡å—ï¼Œç„¶åŽè¿›å…¥compileæµç¨‹ï¼›

###æ’ä»¶


##webpackæ‰“åŒ…çš„è¿è¡Œå‘¨æœŸ



##é¡¹ç›®é…ç½®

    ä¸‹é¢æ˜¯ä¸€ä»½ç§»åŠ¨ç«¯å¤šé¡µé¢é¡¹ç›®çš„webpacké…ç½®æ–‡ä»¶ï¼Œé¢å¤–å¼•å…¥äº†è‡ªå®šä¹‰çš„babelæ’ä»¶ä¼˜åŒ–é¡¹ç›®å¤§å°ã€‚
    
```js
/**
 * è¯´æ˜Ž: webpackçš„é…ç½®è¯·åœ¨è¯¥æ–‡ä»¶è¿›è¡Œä¿®æ”¹
 * webpacké…ç½®æ–‡æ¡£è¯·æŸ¥çœ‹:https://webpack.github.io/docs/configuration.html
 */

var path = require('path');
var os = require('os');
var _ = require('lodash');
var webpack = require('webpack');
var HappyPack = require('happypack');
var happyThreadPool = HappyPack.ThreadPool({size: os.cpus().length + 2});
var glob = require('glob');
var RxPlugin = require('rax-webpack-plugin');
var LiveReloadPlugin = require('webpack-livereload-plugin');
var _definedConfig = require('./_config.webpack.defined');

var CaseSensitivePathsPlugin = require('case-sensitive-paths-webpack-plugin');
//è‡ªå®šä¹‰babelé…ç½®
var babelConfig = require('./babel.config');
var cwd = process.cwd();
var srcPath = path.resolve(__dirname, './src'),
    outputPath = path.resolve(__dirname, './build');

var isWin = /^win/.test(process.platform);
var nukeReg = isWin ? new RegExp(/node_modules\\.*nuke.*/) : new RegExp(/node_modules\/.*nuke.*/);

babelConfig.plugins.push([require.resolve('./transAPI/index.js')]);
var getDevEntry = require('./webpack.entry');



var config = {

    //æœåŠ¡å™¨å¼€å¯çš„ç«¯å£å·
    port: '3000',

    context: srcPath,

    //webpack ç¼–è¯‘çš„å…¥å£æ–‡ä»¶
    entry: getDevEntry(srcPath),

    //è¾“å‡ºçš„æ–‡ä»¶é…ç½®
    output: {
        path: outputPath,
        filename: '[name].js',
        publicPath: '/build/'
    },

    resolve: {
        // root: srcPath,
        modules: [path.join(cwd, "src"), path.join(cwd, "node_modules"), 'node_modules'],
        extensions: ['*', '.js', '.jsx', '.json'],
        alias: {
            'lib': path.resolve(__dirname, './src/lib'),
            'config': path.resolve(__dirname, './src/config'),
            'common': path.resolve(__dirname, './src/common'),
            'src': path.resolve(__dirname, './src'),
            'asset': path.resolve(__dirname, './src/asset'),
            'view': path.resolve(__dirname, './src/view'),
            'component': path.resolve(__dirname, './src/component'),
            'rax': 'weex-rx'
        }
    },

    "externals": [{
        "weex-rx": "commonjs rax",
        "rax": "commonjs rax",
        "nuke": "commonjs nuke",
        "QAP-SDK": "commonjs QAP-SDK",
        "genv": "commonjs genv",
    }],

    module: {
        rules: [{
            test: /\.js|\.jsx?$/,
            include: [
                path.resolve(__dirname, "src")
            ],
            loaders: ['happypack/loader?id=js']
        }, {
            test: /\.rxscss$/,
            loader: 'happypack/loader?id=rxscss',
            include: [
                path.resolve(__dirname, "src"),
                nukeReg
            ]
        }, {
            test: /\.scss$/,
            loaders: ['happypack/loader?id=scss'],
            include: [
                path.resolve(__dirname, "src"),
                nukeReg
            ]
        }, {
            test: /\.json$/,
            loaders: ['happypack/loader?id=json']
        }]
    },

    plugins: [

        new HappyPack({
            cache: true,
            debug: true,
            id: 'js',
            loaders: ['babel-loader'+ '?' + JSON.stringify(babelConfig)],
            threadPool: happyThreadPool
        }),

        new HappyPack({
            cache: true,
            debug: true,
            id: 'rxscss',
            loaders: ['rx-css-loader!sass-loader'],
            threadPool: happyThreadPool
        }),

        new HappyPack({
            cache: true,
            debug: true,
            id: 'scss',
            loaders: ['rx-css-loader!sass-loader'],
            threadPool: happyThreadPool
        }),

        new HappyPack({
            cache: true,
            debug: true,
            id: 'json',
            loaders: ['json-loader'],
            threadPool: happyThreadPool
        }),

        new RxPlugin({
            target: 'bundle'
        }),

        new webpack.NoEmitOnErrorsPlugin(),

        new webpack.optimize.ModuleConcatenationPlugin(),

        //è¿›åº¦æ’ä»¶
        new webpack.ProgressPlugin((percentage, msg) => {
            const stream = process.stderr;
            if (stream.isTTY && percentage < 0.71) {
                stream.cursorTo(0);
                stream.write(`ðŸ“¦   ${msg}`);
                stream.clearLine(1);
            }
        })
    ]
};

```
