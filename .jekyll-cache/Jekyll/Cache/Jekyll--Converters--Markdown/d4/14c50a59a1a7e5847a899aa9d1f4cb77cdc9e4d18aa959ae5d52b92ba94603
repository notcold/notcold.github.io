I"©<h2 id="webpackå®‰è£…">webpackå®‰è£…</h2>

<p>é€šè¿‡nodeå®‰è£…ï¼Œæœ€æ–°</p>
<pre><code>npm install --save-dev webpack

</code></pre>
<p>å¦‚æœä½ ä½¿ç”¨ webpack v4+ ç‰ˆæœ¬ï¼Œä½ è¿˜éœ€è¦å®‰è£… CLIã€‚</p>
<pre><code>npm install --save-dev webpack-cli

</code></pre>

<h2 id="webpacké…ç½®æ–‡ä»¶">webpacké…ç½®æ–‡ä»¶</h2>

<p>webpackæ˜¯ä¸€ä¸ªé™æ€æ–‡ä»¶æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå®ƒä¼šé€šè¿‡è§£æé…ç½®å…¥å£æ–‡ä»¶æ¥ç”Ÿæˆæ‰€æœ‰æ˜ å°„æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œç„¶åå°†è¿™äº›ä¾èµ–ç”Ÿæˆä¸ºbundleã€‚</p>

<pre><code>  // webpack.config.js 
  //ç®€å•çš„å•å…¥å£é…ç½®

const path = require('path');

module.exports = {
  entry: './src/index.js', //é…ç½®æ­è¥¿å…¥å£
  output: {
    filename: 'main.js', //è¾“å…¥ç»“æœ
    path: path.resolve(__dirname, 'dist')
  }
};
</code></pre>

<h3 id="è§£ææ–‡ä»¶">è§£ææ–‡ä»¶</h3>

<p>webpackæ ¹æ®ä¸åŒçš„æ–‡ä»¶æ ¼å¼æ¥åŒ¹é…ç›¸å¯¹åº”çš„ ` loader <code>ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„ </code> loader `æ–‡ä»¶å°±ä¸ä¼šè¢«è§£æå¤„ç†ã€‚</p>
<pre><code>  module.exports = {
    module: {
      rules: [
        { test: /\.css$/, use: 'css-loader' },
        { test: /\.ts$/, use: 'ts-loader' }
      ]
    }
  };
</code></pre>
<p>é…ç½®è§„åˆ™å‘Šè¯‰webpack cssæ–‡ä»¶ç”¨css-loaderæ¥è§£æï¼Œtsæ–‡ä»¶ç”¨ts-loaderæ¥è§£æã€‚</p>
<blockquote>
  <p>loader æè¿°äº† webpack å¦‚ä½•å¤„ç† é JavaScript(non-JavaScript) <em>æ¨¡å—</em>ï¼Œå¹¶ä¸”åœ¨bundleä¸­å¼•å…¥è¿™äº›_ä¾èµ–_ã€‚</p>
</blockquote>

<p>loader è§£æå™¨èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å°†æˆ‘ä»¬ä¹¦å†™çš„æµè§ˆå™¨ä¸æ”¯æŒçš„å½¢å¼è£…æ¢ä¸ºæ ‡å‡†çš„jsï¼Œhtmlè¯­æ³•ï¼Œä»è€Œèƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚</p>

<p>###æ¨¡å—</p>

<p>æ‰€æœ‰çš„æ–‡ä»¶è¢« ` loader `è§£æä¹‹åç”Ÿæˆçš„éƒ½æ˜¯æ¨¡å—ï¼Œç„¶åè¿›å…¥compileæµç¨‹ï¼›</p>

<p>###æ’ä»¶</p>

<p>##webpackæ‰“åŒ…çš„è¿è¡Œå‘¨æœŸ</p>

<p>##é¡¹ç›®é…ç½®</p>

<pre><code>ä¸‹é¢æ˜¯ä¸€ä»½ç§»åŠ¨ç«¯å¤šé¡µé¢é¡¹ç›®çš„webpacké…ç½®æ–‡ä»¶ï¼Œé¢å¤–å¼•å…¥äº†è‡ªå®šä¹‰çš„babelæ’ä»¶ä¼˜åŒ–é¡¹ç›®å¤§å°ã€‚
</code></pre>

<pre><code class="language-js">/**
 * è¯´æ˜: webpackçš„é…ç½®è¯·åœ¨è¯¥æ–‡ä»¶è¿›è¡Œä¿®æ”¹
 * webpacké…ç½®æ–‡æ¡£è¯·æŸ¥çœ‹:https://webpack.github.io/docs/configuration.html
 */

var path = require('path');
var os = require('os');
var _ = require('lodash');
var webpack = require('webpack');
var HappyPack = require('happypack');
var happyThreadPool = HappyPack.ThreadPool({size: os.cpus().length + 2});
var glob = require('glob');
var RxPlugin = require('rax-webpack-plugin');
var LiveReloadPlugin = require('webpack-livereload-plugin');
var _definedConfig = require('./_config.webpack.defined');

var CaseSensitivePathsPlugin = require('case-sensitive-paths-webpack-plugin');
//è‡ªå®šä¹‰babelé…ç½®
var babelConfig = require('./babel.config');
var cwd = process.cwd();
var srcPath = path.resolve(__dirname, './src'),
    outputPath = path.resolve(__dirname, './build');

var isWin = /^win/.test(process.platform);
var nukeReg = isWin ? new RegExp(/node_modules\\.*nuke.*/) : new RegExp(/node_modules\/.*nuke.*/);

babelConfig.plugins.push([require.resolve('./transAPI/index.js')]);
var getDevEntry = require('./webpack.entry');



var config = {

    //æœåŠ¡å™¨å¼€å¯çš„ç«¯å£å·
    port: '3000',

    context: srcPath,

    //webpack ç¼–è¯‘çš„å…¥å£æ–‡ä»¶
    entry: getDevEntry(srcPath),

    //è¾“å‡ºçš„æ–‡ä»¶é…ç½®
    output: {
        path: outputPath,
        filename: '[name].js',
        publicPath: '/build/'
    },

    resolve: {
        // root: srcPath,
        modules: [path.join(cwd, "src"), path.join(cwd, "node_modules"), 'node_modules'],
        extensions: ['*', '.js', '.jsx', '.json'],
        alias: {
            'lib': path.resolve(__dirname, './src/lib'),
            'config': path.resolve(__dirname, './src/config'),
            'common': path.resolve(__dirname, './src/common'),
            'src': path.resolve(__dirname, './src'),
            'asset': path.resolve(__dirname, './src/asset'),
            'view': path.resolve(__dirname, './src/view'),
            'component': path.resolve(__dirname, './src/component'),
            'rax': 'weex-rx'
        }
    },

    "externals": [{
        "weex-rx": "commonjs rax",
        "rax": "commonjs rax",
        "nuke": "commonjs nuke",
        "QAP-SDK": "commonjs QAP-SDK",
        "genv": "commonjs genv",
    }],

    module: {
        rules: [{
            test: /\.js|\.jsx?$/,
            include: [
                path.resolve(__dirname, "src")
            ],
            loaders: ['happypack/loader?id=js']
        }, {
            test: /\.rxscss$/,
            loader: 'happypack/loader?id=rxscss',
            include: [
                path.resolve(__dirname, "src"),
                nukeReg
            ]
        }, {
            test: /\.scss$/,
            loaders: ['happypack/loader?id=scss'],
            include: [
                path.resolve(__dirname, "src"),
                nukeReg
            ]
        }, {
            test: /\.json$/,
            loaders: ['happypack/loader?id=json']
        }]
    },

    plugins: [

        new HappyPack({
            cache: true,
            debug: true,
            id: 'js',
            loaders: ['babel-loader'+ '?' + JSON.stringify(babelConfig)],
            threadPool: happyThreadPool
        }),

        new HappyPack({
            cache: true,
            debug: true,
            id: 'rxscss',
            loaders: ['rx-css-loader!sass-loader'],
            threadPool: happyThreadPool
        }),

        new HappyPack({
            cache: true,
            debug: true,
            id: 'scss',
            loaders: ['rx-css-loader!sass-loader'],
            threadPool: happyThreadPool
        }),

        new HappyPack({
            cache: true,
            debug: true,
            id: 'json',
            loaders: ['json-loader'],
            threadPool: happyThreadPool
        }),

        new RxPlugin({
            target: 'bundle'
        }),

        new webpack.NoEmitOnErrorsPlugin(),

        new webpack.optimize.ModuleConcatenationPlugin(),

        //è¿›åº¦æ’ä»¶
        new webpack.ProgressPlugin((percentage, msg) =&gt; {
            const stream = process.stderr;
            if (stream.isTTY &amp;&amp; percentage &lt; 0.71) {
                stream.cursorTo(0);
                stream.write(`ğŸ“¦   ${msg}`);
                stream.clearLine(1);
            }
        })
    ]
};

</code></pre>
:ET